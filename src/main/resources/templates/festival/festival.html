<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FesLite — 축제 상세</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link th:href="@{css/style.css}" rel="stylesheet">
<script th:inline="javascript">
  const festival_idx = [[${festival.festival_idx}]];
</script>
<script defer th:src="@{/js/app.js}"></script>
<script defer th:src="@{/js/map.js}"></script>
<script defer th:src="@{/js/weather.js}"></script>
<!-- <script defer th:src="@{/js/aiChat.js}"></script> -->
<script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=u4pl1guhug"></script>

</head>

<body class="bg-gradient-festive">
  <!-- 상단 네비바 -->
  <div th:replace="~{common/header :: header}"></div>

  <main class="container py-5">
    <div class="row align-items-stretch g-4">
      <!-- 왼쪽 패널 -->
      <div class="col-lg-8 d-flex">
        <div class="gradient-card w-100">
          <div class="body">
            <div style="border-radius: 12px; overflow: hidden; margin-bottom: 20px;">
              <a th:href="${festival.festival_link}">
              <img th:src="${festival.festival_img_path}" 
                class="img-fluid rounded-4 shadow" 
                style="max-height: 600px; width: 100%; object-fit: contain;" 
                alt="축제 포스터">
              </a>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-2">
              <div>
                <h3 class="fw-bold mb-0" th:text="${festival.festival_name}"></h3>
                <div class="text-muted mt-1">
                  <span th:text="${festival.festival_begin_date}"></span> ~
                  <span th:text="${festival.festival_end_date}"></span>
                </div>
                <span class="chip">요금: <span th:text="${festival.festival_fee}"></span></span>
              </div>
            </div>

            <div class="mb-2"><b>주최:</b> <span th:text="${festival.festival_host}"></span></div>
            <div class="mb-3"><b>주소:</b> <span th:text="${festival.festival_address}"></span></div>

            <hr>
            <h5 class="fw-bold mb-2">상세 소개</h5>
            <p th:text="${festival.festival_info}" style="white-space:pre-line;"></p>
            <span th:if="${festival.festival_info == '상세내용은 공식 사이트를 참조해 주세요'}"><a th:href="${festival.festival_link}" target="_blank"  style="text-decoration: none;"> - 공식사이트(클릭)</a></span>

            <!-- 지도 / 길찾기 -->
            <div class="section">
              <h5 class="fw-bold mb-3">지도 / 길찾기 (임시)</h5>
              <div class="gradient-card">
                <div class="body">
                  <div id ="map" class="map"></div>
                </div>
              </div>
            </div>

            <!-- 날씨 섹션 -->
            <div class="section">
              <h5 class="fw-bold mb-3">날씨 (목데이터)</h5>
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="gradient-card">
                    <div class="body text-center">
                      <div class="fw-bold" id="weather_time_today"></div>
                      <div class="text-muted" id="weather_sky_today"></div>
                      <div class="mt-2">
                        <span class="chip">🌡️최저<span id="weather_temp_min_today"></span>℃</span>
                        <span class="chip">🌡️최고<span id="weather_temp_max_today"></span>℃</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="gradient-card">
                    <div class="body text-center">
                      <div class="fw-bold" id="weather_time_tomorrow"></div>
                      <div class="text-muted" id="weather_sky_tomorrow"></div>
                      <div class="mt-2">
                        <span class="chip">🌡️최저<span id="weather_temp_min_tomorrow"></span>℃</span>
                        <span class="chip">🌡️최고<span id="weather_temp_max_tomorrow"></span>℃</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="gradient-card">
                    <div class="body text-center">
                      <div class="fw-bold" id="weather_time_dat"></div>
                      <div class="text-muted" id="weather_sky_dat"></div>
                      <div class="mt-2">
                        <span class="chip">🌡️최저<span id="weather_temp_min_dat"></span>℃</span>
                        <span class="chip">🌡️최고<span id="weather_temp_max_dat"></span>℃</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 주변 즐길거리 -->
            <div class="section">
              <h5 class="fw-bold mb-3">주변 즐길거리</h5>
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="gradient-card">
                    <div class="body text-center">
                      <div class="fw-bold">카페 블루문</div>
                      <div class="text-muted">카페 · 300m</div>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="gradient-card">
                    <div class="body text-center">
                      <div class="fw-bold">한강 뷰 레스토랑</div>
                      <div class="text-muted">음식점 · 500m</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- 오른쪽 패널 -->
<div class="col-lg-4 d-flex flex-column justify-content-start" style="gap: 0.25rem;">
  <!-- 리뷰 -->
  <div class="gradient-card" style="max-height: 500px; height: 500px;">
    <div class="body d-flex flex-column h-100">
      <h5 class="fw-bold mb-3">리뷰</h5>
      <div id="reviewList" class="vstack gap-2 mb-3 flex-grow-1 overflow-auto">
        <div class="border rounded p-2 bg-light"><b>익명</b> — 정말 재밌었어요!</div>
      </div>
      <div class="input-group mt-auto">
        <input type="text" class="form-control" id="reviewText" placeholder="한줄 리뷰 작성" />
        <button class="btn-gradient" id="btnAddReview">등록</button>
      </div>
    </div>
  </div>

  <!-- 채팅 -->
  <div class="gradient-card" style="max-height: 500px; height: 500px;">
    <div class="body d-flex flex-column h-100">
      <h5 class="fw-bold mb-3">채팅방</h5>
      <div class="chat-box flex-grow-1 overflow-auto" id="chatBox">
        <div class="bubble other">
          안녕하세요! 🎉
          <small>관리자 · 12:30</small>
        </div>
      </div>
      <div class="input-group mt-2">
        <input type="text" id="chatInput" class="form-control" placeholder="메시지 입력..." />
        <button class="btn-gradient" id="btnSendChat">보내기</button>
      </div>
    </div>
  </div>
</div>


        
      </div>
    </div>
  </main>

  <!-- 하단 푸터 -->
  <div th:replace="~{common/footer :: footer}"></div>

  <script>
    // 리뷰 추가
    document.getElementById("btnAddReview").addEventListener("click", () => {
      const text = document.getElementById("reviewText").value.trim();
      if (!text) return;
      const div = document.createElement("div");
      div.className = "border rounded p-2 bg-light";
      div.innerHTML = `<b>익명</b> — ${text}`;
      document.getElementById("reviewList").prepend(div);
      document.getElementById("reviewText").value = "";
    });

    // 채팅 기능
    const chatBox = document.getElementById("chatBox");
    const chatInput = document.getElementById("chatInput");

    function addMessage(text, sender = "me") {
      const div = document.createElement("div");
      div.className = `bubble ${sender}`;
      const now = new Date();
      const time = now.toLocaleTimeString("ko-KR", { hour: "2-digit", minute: "2-digit" });
      div.innerHTML = `${text}<small>${sender === "me" ? "나" : "관리자"} · ${time}</small>`;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function sendChat() {
      const msg = chatInput.value.trim();
      if (!msg) return;
      addMessage(msg, "me");
      chatInput.value = "";
      setTimeout(() => addMessage("문의 감사합니다!", "other"), 700);
    }

    document.getElementById("btnSendChat").addEventListener("click", sendChat);
    chatInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendChat();
      }
    });

  </script>
</body>
</html>
