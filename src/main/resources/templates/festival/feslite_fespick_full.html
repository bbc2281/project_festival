<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FesLite Ã— FesPick â€” ì¶•ì œ í”Œë«í¼ (í†µí•©)</title>
  <style>
    :root{
      --bg:#ffffff;
      --surface:#f8fafc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --brand:#2563eb;
      --brand-2:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --border:#e2e8f0;
      --chip:#f1f5f9;
      --shadow:0 6px 20px rgba(15,23,42,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,"Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic","ë§‘ì€ ê³ ë”•",sans-serif;
      background:linear-gradient(180deg,#ffffff 0%, #f6f8fb 100%);
      color:var(--text);
    }
    a{color:inherit;text-decoration:none}
    .container{max-width:1140px;margin:0 auto;padding:20px}
    header{
      position:sticky;top:0;z-index:50;backdrop-filter:saturate(140%) blur(8px);
      background:rgba(255,255,255,.8);border-bottom:1px solid var(--border)
    }
    .nav{display:flex;align-items:center;gap:14px;padding:12px 20px}
    .logo{font-weight:800;letter-spacing:.2px}
    .pill{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#fff}
    .spacer{flex:1}
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:#fff;padding:10px 14px;border-radius:12px;cursor:pointer;box-shadow:var(--shadow);transition:.15s transform,.15s filter}
    .btn:hover{filter:brightness(1.04);transform:translateY(-1px)}
    .btn.brand{background:linear-gradient(180deg,#3b82f6,#2563eb);border-color:#2563eb;color:#fff}
    .btn.ghost{background:transparent;box-shadow:none}
    .btn.ok{background:linear-gradient(180deg,#16a34a,#22c55e);border-color:#22c55e;color:#fff}
    .btn.danger{background:linear-gradient(180deg,#ef4444,#dc2626);border-color:#ef4444;color:#fff}

    .grid{display:grid;gap:16px}
    .g-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .g-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    @media(max-width:980px){.g-3{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:640px){.g-3,.g-2{grid-template-columns:1fr}}

    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden;box-shadow:var(--shadow)}
    .card .body{padding:14px 16px}
    .tag{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:rgba(2,6,23,.04);border:1px solid var(--border);font-size:12px;color:var(--muted)}
    .row{display:flex;gap:10px;align-items:center}
    .row-between{display:flex;justify-content:space-between;align-items:center}
    .muted{color:var(--muted)}
    .h1{font-size:28px;font-weight:800}
    .h2{font-size:20px;font-weight:700}
    .h3{font-size:16px;font-weight:700}
    .section{margin:28px 0}
    .chip{display:inline-flex;align-items:center;gap:6px;background:var(--chip);border:1px solid var(--border);border-radius:9px;padding:6px 10px;color:#334155;font-size:12px}
    .hr{height:1px;background:var(--border);margin:14px 0}

    /* page switcher */
    .page{display:none}
    .page.active{display:block}

    /* table */
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left}
    th{color:#334155;font-size:12px;text-transform:uppercase;letter-spacing:.04em;background:#f8fafc}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:20px}
    .modal{width:min(720px,100%);background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
    .modal-head{padding:16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
    .modal-body{padding:16px}

    /* form */
    .field{display:grid;gap:6px;margin-bottom:12px}
    .field label{font-size:12px;color:#475569}
    input[type="text"],input[type="date"],input[type="password"],textarea,select{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);
      background:#fff;color:var(--text);outline:none
    }
    textarea{min-height:100px}

    .avatar{width:32px;height:32px;border-radius:50%;background:#eef2ff;border:1px solid var(--border)}

    /* chat */
    .chat{height:240px;overflow:auto;padding:10px;border:1px solid var(--border);border-radius:12px;background:#fff}
    .bubble{max-width:80%;margin:6px 0;padding:10px;border-radius:12px;}
    .bubble.me{margin-left:auto;background:#e2e8f0}
    .bubble.other{background:#f1f5f9}

    /* toast */
    .toast{position:fixed;right:12px;bottom:12px;background:#111827;color:#fff;border:1px solid #0b1227;padding:12px 14px;border-radius:12px;display:none;box-shadow:var(--shadow)}
  </style>
</head>
<body>
  <header>
    <nav class="nav container">
      <a class="logo h2" href="#" data-link="home">ğŸ‰ FesPick</a>
      <a class="pill" href="#" data-link="list">ì¶•ì œ</a>
      <a class="pill" href="#" data-link="board">ê²Œì‹œíŒ</a>
      <a class="pill" href="#" data-link="register">ì¶•ì œ ë“±ë¡</a>

      <div class="spacer"></div>
      <input id="globalSearch" placeholder="ì¶•ì œ/ì§€ì—­ ê²€ìƒ‰" class="pill" style="min-width:220px" />
      <button class="btn" id="btnSearch">ê²€ìƒ‰</button>

      <!-- ìš°ì¸¡ ìƒë‹¨: ë¡œê·¸ì¸/íšŒì›ê°€ì…/ê´€ë¦¬ì -->
      <button class="btn ghost" id="btnLogin">ë¡œê·¸ì¸</button>
      <button class="btn ghost" id="btnSignup">íšŒì›ê°€ì…</button>
      <button class="btn brand" id="btnAdmin">ê´€ë¦¬ì</button>

      <!-- ë¡œê·¸ì¸ í›„ -->
      <div id="meBox" class="row" style="display:none">
        <div class="avatar"></div>
        <span class="muted">ë§ˆì´í˜ì´ì§€</span>
        <button class="btn ghost" id="btnLogout">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </nav>
  </header>

  <main class="container">
    <!-- HOME -->
    <section id="page-home" class="page active">
      <div class="section">
        <div class="card">
          <div class="body">
            <div class="row-between">
              <div>
                <div class="h1">ì§€ì—­ ì¶•ì œë¥¼ í•œ ëˆˆì— ğŸ¡</div>
                <div class="muted" style="margin-top:6px">ì¹´í…Œê³ ë¦¬/ì§€ì—­/ë‚ ì”¨ ì •ë³´, í›„ê¸°, ëŒ“ê¸€, ì¶•ì œ ë“±ë¡ ë° ê´€ë¦¬ì ìŠ¹ì¸ê¹Œì§€ í•œ ê³³ì—ì„œ</div>
                <div style="margin-top:12px" class="row">
                  <span class="chip">ì¸ê¸°ìˆœ</span>
                  <span class="chip">ë‹¤ê°€ì˜¤ëŠ” ì¶•ì œ</span>
                  <span class="chip">ì§€ì—­ë³„</span>
                </div>
              </div>
              <button class="btn brand" data-link="list">ì§€ê¸ˆ ì¸ê¸° ì¶•ì œ ë³´ê¸°</button>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="row-between">
          <div class="h2">ì´ë²ˆ ì£¼ ì¶”ì²œ</div>
          <a class="muted" href="#" data-link="list">ì „ì²´ ë³´ê¸° â†’</a>
        </div>
        <div class="grid g-3" id="homeGrid"></div>
      </div>
    </section>

    <!-- LIST -->
    <section id="page-list" class="page">
      <div class="row-between section">
        <div class="h2">ì¶•ì œ ëª©ë¡</div>
        <div class="row">
          <select id="filterRegion">
            <option value="">ì „ì²´ ì§€ì—­</option>
          </select>
          <select id="filterSort">
            <option value="popular">ì¸ê¸°ìˆœ</option>
            <option value="latest">ìµœì‹ ìˆœ</option>
            <option value="near">ê°€ê¹Œìš´ìˆœ(ëª¨ì˜)</option>
          </select>
        </div>
      </div>
      <div class="grid g-3" id="listGrid"></div>
    </section>

    <!-- DETAIL -->
    <section id="page-detail" class="page">
      <div class="section" id="detailWrap"></div>
    </section>

    <!-- BOARD & PAYMENT -->
    <section id="page-board" class="page">
      <div class="section">
        <div class="row-between"><div class="h2">ê³µì§€ / ì´ë²¤íŠ¸</div><span class="muted">ê´€ë¦¬ì ì‘ì„±</span></div>
        <div class="card"><div class="body">
          <div class="row" style="margin-bottom:10px">
            <input id="noticeTitle" class="pill" placeholder="ì œëª©" style="flex:1">
            <button class="btn brand" id="btnPostNotice">ì‘ì„±</button>
          </div>
          <textarea id="noticeBody" placeholder="ë‚´ìš©"></textarea>
        </div></div>
        <div class="card" style="margin-top:12px"><div class="body">
          <table id="noticeTable">
            <thead><tr><th>ì œëª©</th><th>ì‘ì„±ì</th><th>ë‚ ì§œ</th></tr></thead>
            <tbody></tbody>
          </table>
        </div></div>
      </div>

      <div class="section">
        <div class="row-between"><div class="h2">ì¶•ì œ ë¦¬ë·°</div><span class="muted">ë¦¬ë·°ì— ëŒ“ê¸€ ê°€ëŠ¥</span></div>
        <div class="card"><div class="body">
          <div class="row" style="margin-bottom:10px">
            <input id="reviewUser" class="pill" placeholder="ë‹‰ë„¤ì„">
            <input id="reviewText" class="pill" placeholder="ë¦¬ë·° ë‚´ìš©" style="flex:1">
            <button class="btn" id="btnAddReview">ë“±ë¡</button>
          </div>
          <div id="reviewList"></div>
        </div></div>
      </div>

      <div class="section">
        <div class="row-between"><div class="h2">ê²°ì œ(ëª¨ì˜)</div><span class="muted">ìŠ¹ì¸ í›„ ìœ ë£Œ ë¶€ìŠ¤/ìŠ¤í°ì„œ ê²°ì œ</span></div>
        <div class="card"><div class="body row-between">
          <div>
            <div class="h3">ìŠ¤í°ì„œ íŒ¨í‚¤ì§€ A</div>
            <div class="muted">ë©”ì¸ ë°°ë„ˆ ë…¸ì¶œ + ë¶€ìŠ¤ 1ê°œ</div>
          </div>
          <div class="row" style="gap:12px">
            <div class="h2">â‚© 500,000</div>
            <button class="btn ok" id="btnPay">ê²°ì œí•˜ê¸°</button>
          </div>
        </div></div>
      </div>
    </section>

    <!-- REGISTER (ê¸°ì•ˆì„œ â†’ ì¶•ì œ ë“±ë¡) -->
    <section id="page-register" class="page">
      <div class="section">
        <div class="h2">ì¶•ì œ ë“±ë¡</div>
        <div class="card"><div class="body">
          <div class="grid g-2">
            <div class="field"><label>ì£¼ìµœ ìœ í˜•</label>
              <select id="orgType"><option value="PERSON">ì¼ë°˜</option><option value="COMPANY">ê¸°ì—…</option></select>
            </div>
            <div class="field"><label>ë‹´ë‹¹ì ì—°ë½ì²˜</label><input id="contact" type="text" placeholder="010-0000-0000"></div>
            <div class="field"><label>ì¶•ì œëª…</label><input id="pName" type="text" placeholder="ì˜ˆ) ë¶€ì‚° ë¶ˆê½ƒì¶•ì œ"></div>
            <div class="field"><label>ì§€ì—­</label><input id="pRegion" type="text" placeholder="ë¶€ì‚°"></div>
            <div class="field"><label>ì£¼ì†Œ</label><input id="pAddress" type="text" placeholder="ìƒì„¸ ì£¼ì†Œ"></div>
            <div class="field"><label>ê¸°ê°„</label>
              <div class="row"><input id="pStart" type="date"><input id="pEnd" type="date"></div>
            </div>
            <div class="field" style="grid-column:1/-1"><label>ì„¤ëª…</label><textarea id="pDesc" placeholder="í–‰ì‚¬ ìƒì„¸ ì„¤ëª…"></textarea></div>
          </div>
          <div class="row" style="justify-content:flex-end;margin-top:10px">
            <button class="btn" id="btnPreviewProposal">ë¯¸ë¦¬ë³´ê¸°</button>
            <button class="btn brand" id="btnSubmitProposal">ì œì¶œ</button>
          </div>
        </div></div>
      </div>
    </section>

    <!-- ADMIN -->
    <section id="page-admin" class="page">
      <div class="section">
        <div class="row-between"><div class="h2">ê´€ë¦¬ì í˜ì´ì§€</div><span class="muted">ê³µì§€/ë¦¬ë·°/ì¶•ì œ ìŠ¹ì¸</span></div>
        <div class="grid g-2">
          <div class="card"><div class="body">
            <div class="h3">ìŠ¹ì¸ ëŒ€ê¸° ë“±ë¡</div>
            <table id="tblProposals"><thead><tr><th>ì¶•ì œëª…</th><th>ì£¼ìµœ</th><th>ê¸°ê°„</th><th>ìŠ¹ì¸</th></tr></thead><tbody></tbody></table>
          </div></div>
          <div class="card"><div class="body">
            <div class="h3">ì¶•ì œ ì •ë³´ ê´€ë¦¬</div>
            <table id="tblFestivals"><thead><tr><th>ì´ë¦„</th><th>ì§€ì—­</th><th>ê¸°ê°„</th><th>ê´€ë¦¬</th></tr></thead><tbody></tbody></table>
          </div></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Signup Choice Modal -->
  <div class="modal-backdrop" id="modalSignupChoice">
    <div class="modal">
      <div class="modal-head"><div class="h3">íšŒì›ê°€ì… ìœ í˜• ì„ íƒ</div><button class="btn ghost" data-close="modalSignupChoice">ë‹«ê¸°</button></div>
      <div class="modal-body">
        <div class="grid g-2">
          <div class="card">
            <div class="body">
              <div class="h3">ğŸ‘¤ ì¼ë°˜íšŒì›</div>
              <p class="muted">ë¦¬ë·°/ëŒ“ê¸€/ì°œ ê¸°ëŠ¥ ì´ìš©</p>
              <button class="btn brand" id="goSignupUser">ì¼ë°˜íšŒì› ê°€ì…</button>
            </div>
          </div>
          <div class="card">
            <div class="body">
              <div class="h3">ğŸ¢ ê¸°ì—…íšŒì›</div>
              <p class="muted">ì¶•ì œ ë“±ë¡/ë¶€ìŠ¤/ìŠ¤í°ì„œ ê´€ë¦¬</p>
              <button class="btn brand" id="goSignupCompany">ê¸°ì—…íšŒì› ê°€ì…</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Signup Form Modal (shared) -->
  <div class="modal-backdrop" id="modalSignupForm">
    <div class="modal">
      <div class="modal-head"><div class="h3" id="signupTitle">íšŒì›ê°€ì…</div><button class="btn ghost" data-close="modalSignupForm">ë‹«ê¸°</button></div>
      <div class="modal-body">
        <div class="grid g-2">
          <div class="field"><label>ì´ë¦„</label><input id="suName" type="text" placeholder="í™ê¸¸ë™"></div>
          <div class="field"><label>ì´ë©”ì¼</label><input id="suEmail" type="text" placeholder="you@example.com"></div>
          <div class="field"><label>ë¹„ë°€ë²ˆí˜¸</label><input id="suPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
          <div class="field"><label>ì—°ë½ì²˜</label><input id="suPhone" type="text" placeholder="010-0000-0000"></div>
          <div class="field company-only" style="display:none"><label>íšŒì‚¬ëª…</label><input id="suCompany" type="text" placeholder="í˜ìŠ¤í”½ ì£¼ì‹íšŒì‚¬"></div>
          <div class="field company-only" style="display:none"><label>ì‚¬ì—…ìë²ˆí˜¸</label><input id="suBiz" type="text" placeholder="000-00-00000"></div>
        </div>
        <div class="row" style="justify-content:flex-end;margin-top:10px">
          <button class="btn brand" id="btnDoSignup">ê°€ì…í•˜ê¸°</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div class="modal-backdrop" id="modalLogin">
    <div class="modal">
      <div class="modal-head"><div class="h3">ë¡œê·¸ì¸</div><button class="btn ghost" data-close="modalLogin">ë‹«ê¸°</button></div>
      <div class="modal-body">
        <div class="grid g-2">
          <div class="field" style="grid-column:1/-1"><label>ì´ë©”ì¼</label><input id="lgEmail" type="text" placeholder="you@example.com"></div>
          <div class="field" style="grid-column:1/-1"><label>ë¹„ë°€ë²ˆí˜¸</label><input id="lgPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
        </div>
        <div class="row" style="justify-content:flex-end;margin-top:10px">
          <button class="btn brand" id="btnDoLogin">ë¡œê·¸ì¸</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Proposal Preview Modal -->
  <div class="modal-backdrop" id="modalPreview">
    <div class="modal">
      <div class="modal-head"><div class="h3">ì¶•ì œ ë“±ë¡ ë¯¸ë¦¬ë³´ê¸°</div><button class="btn ghost" data-close="modalPreview">ë‹«ê¸°</button></div>
      <div class="modal-body" id="previewBody"></div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <script>
    // ===== Mock Data =====
    const FESTIVALS = [ ];

  document.addEventListener("DOMContentLoaded", function(){
  fetch("/api/festivals")
  .then(res => res.json())
  .then(festivals =>{
    festivals.forEach(festival =>{
      console.log(festival)
      const formattedFestival = {
        id: festival.festival_idx,
        name: festival.festival_name || 'ì´ë¦„ ì—†ìŒ',
        category: festival.festival_category_name || 'ê¸°íƒ€',
        region: 'ì„œìš¸',
        city: festival.region_name || '',
        begin: festival.festival_begin_date || '',   // ë‚ ì§œ ê°€ê³µì´ í•„ìš”í•  ìˆ˜ ìˆìŒ
        end: festival.festival_end_date || '',     // ì¢…ë£Œì¼ì´ ì—†ì„ ê²½ìš° ë¹ˆê°’
        fee: festival.festival_fee,     // ìš”ê¸ˆ ì •ë³´ ì—†ì„ ê²½ìš° ê¸°ë³¸ê°’
        host: festival.festival_host || 'ì„œìš¸ì‹œ',
        img: festival.festival_img_path || 'https://via.placeholder.com/400x300?text=No+Image',
        info: festival.festival_info || 'ì¥ì†Œ ì •ë³´ ì—†ìŒ',
        address: festival.festival_address || '',
        lat: parseFloat(festival.LAT) || 0,
        lng: parseFloat(festival.LOT) || 0,
        like: 0,
      };
      FESTIVALS.push(formattedFestival);
      console.log(formattedFestival);
    })
    if (qs('#heroInner')) renderHome();
  })
  .catch(err =>{
    console.log(err);
  })

});

    const state={
      page:'home',
      user:null,
      notices:[],
      reviews:[],
      proposals:[],
      chat:{},
      signupType:'USER' // or COMPANY
    };

    // ===== Helpers =====
    const $=sel=>document.querySelector(sel);
    const $$=sel=>document.querySelectorAll(sel);
    const showToast=(msg)=>{const t=$('#toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',1800)}
    const fmtDate=(d)=> new Date(d).toLocaleDateString('ko-KR');

    function setPage(id){
      state.page=id;
      $$('.page').forEach(p=>p.classList.remove('active'));
      $('#page-'+id).classList.add('active');
      if(id==='list') renderList();
      if(id==='home') renderHome();
    }

    // ===== Home/List/Detail =====
    function renderHome(){
      const grid=$('#homeGrid');
      grid.innerHTML=FESTIVALS.slice(0,3).map(cardHtml(f)).join('');
      grid.querySelectorAll('[data-open]').forEach(el=>el.addEventListener('click',()=>openDetail(el.dataset.open)))
    }

    function cardHtml(f){
      return `<div class="card">
        <div style="aspect-ratio:16/9;background:url('${f.thumbnail}') center/cover"></div>
        <div class="body">
          <div class="row-between">
            <div class="h3">${f.name}</div>
            <div class="tag">â¤ ${f.likes}</div>
          </div>
          <div class="muted">${f.region} Â· ${fmtDate(f.start)} ~ ${fmtDate(f.end)}</div>
          <div class="row" style="margin-top:8px">${f.tags.map(t=>`<span class='chip'>#${t}</span>`).join('')}</div>
          <div class="row" style="margin-top:12px;justify-content:flex-end">
            <button class="btn" data-open="${f.id}">ìì„¸íˆ</button>
          </div>
        </div>
      </div>`
    }

    function renderList(){
      const regions=[...new Set(mockFestivals.map(f=>f.region))];
      const sel=$('#filterRegion');
      if(sel.options.length<=1){ regions.forEach(r=>{const o=document.createElement('option');o.value=r;o.textContent=r; sel.appendChild(o)}) }
      const query=$('#globalSearch').value.trim().toLowerCase();
      const region=sel.value;
      const sort=$('#filterSort').value;
      let list=mockFestivals.filter(f=>{
        const hit=query? (f.name+f.region+f.city+f.tags.join(' ')).toLowerCase().includes(query):true;
        const reg=region? f.region===region : true;
        return hit && reg;
      });
      if(sort==='popular') list.sort((a,b)=>b.likes-a.likes);
      if(sort==='latest') list.sort((a,b)=> new Date(b.start)-new Date(a.start));
      const grid=$('#listGrid');
      grid.innerHTML=list.map(cardHtml).join('');
      grid.querySelectorAll('[data-open]').forEach(el=>el.addEventListener('click',()=>openDetail(el.dataset.open)))
    }

    function openDetail(id){
      const f=mockFestivals.find(x=>x.id===id);
      if(!f) return;
      const wrap=$('#detailWrap');
      setPage('detail');
      wrap.innerHTML=`
        <div class="row" style="gap:16px;align-items:stretch">
          <div class="card" style="flex:2">
            <div style="aspect-ratio:16/9;background:url('${f.thumbnail}') center/cover"></div>
            <div class="body">
              <div class="row-between">
                <div>
                  <div class="h1">${f.name}</div>
                  <div class="muted">${f.region} ${f.city} Â· ${fmtDate(f.start)} ~ ${fmtDate(f.end)}</div>
                </div>
                <div class="row" style="gap:10px"><span class="tag">â¤ ${f.likes}</span><span class="tag">ë¦¬ë·° ê°€ëŠ¥</span></div>
              </div>
              <div class="hr"></div>
              <p>${f.desc}</p>
              <div class="section">
                <div class="h3">ì§€ë„ / ê¸¸ì°¾ê¸°(ì„ì‹œ)</div>
                <div style="height:220px;border:1px dashed var(--border);border-radius:12px;display:flex;align-items:center;justify-content:center" class="muted">ë„¤ì´ë²„ ê¸¸ì°¾ê¸° API ìë¦¬</div>
              </div>
              <div class="section">
                <div class="h3">ë‚ ì”¨(ëª©ë°ì´í„°)</div>
                <div class="grid g-3">${f.weather.map(w=>`<div class='card'><div class='body'><div class='h3'>${fmtDate(w.date)}</div><div class='muted'>${w.summary}</div><div class='row' style='gap:10px;margin-top:6px'><span class='chip'>ìµœì € ${w.min}Â°</span><span class='chip'>ìµœê³  ${w.max}Â°</span></div></div></div>`).join('')}</div>
              </div>
              <div class="section">
                <div class="h3">ì£¼ë³€ ì¦ê¸¸ê±°ë¦¬</div>
                <div class="grid g-3">${f.nearby.map(n=>`<div class='card'><div class='body'><div class='h3'>${n.name}</div><div class='muted'>${n.type} Â· ${n.address}</div><div class='chip' style='margin-top:6px'>${n.distanceMeter} m</div></div></div>`).join('')}</div>
              </div>
            </div>
          </div>
          <div style="flex:1" class="grid" >
            <div class="card">
              <div class="body">
                <div class="h3">ë¦¬ë·°</div>
                <div id="detailReviews"></div>
                <div class="row" style="margin-top:10px">
                  <input id="detailReviewUser" placeholder="ë‹‰ë„¤ì„" class="pill">
                  <input id="detailReviewText" placeholder="í•œì¤„ ë¦¬ë·°" class="pill" style="flex:1">
                  <button class="btn" id="btnDetailAddReview">ë“±ë¡</button>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="body">
                <div class="h3">ì¶•ì œ ì±„íŒ…ë°© <span class="muted">(ì¶•ì œë‹¹ 1ê°œ)</span></div>
                <div id="chatBox" class="chat"></div>
                <div class="row" style="margin-top:8px">
                  <input id="chatInput" class="pill" placeholder="ë©”ì‹œì§€">
                  <button class="btn" id="btnSendChat">ë³´ë‚´ê¸°</button>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="body row-between">
                <div>
                  <div class="h3">ë¶€ìŠ¤ ì˜ˆì•½(ëª¨ì˜)</div>
                  <div class="muted">ì£¼ìµœì¸¡ ìŠ¹ì¸ í›„ ê²°ì œ ì§„í–‰</div>
                </div>
                <button class="btn ok" id="btnDetailPay">ê²°ì œ</button>
              </div>
            </div>
          </div>
        </div>
      `;
      renderReviewsFor(id,$('#detailReviews'));
      $('#btnDetailAddReview').onclick=()=>{
        const u=$('#detailReviewUser').value||'ìµëª…';
        const t=$('#detailReviewText').value.trim();
        if(!t) return;
        state.reviews.push({festivalId:id,user:u,text:t,createdAt:Date.now(),replies:[]});
        renderReviewsFor(id,$('#detailReviews'));
        $('#detailReviewText').value='';
      }
      const chat=state.chat[id]||(state.chat[id]=[]);
      const chatBox=$('#chatBox');
      function renderChat(){
        chatBox.innerHTML=chat.map(m=>`<div class="bubble ${m.me?'me':'other'}">${m.msg}<div class='muted' style='font-size:10px;margin-top:4px'>${new Date(m.ts).toLocaleTimeString('ko-KR')}</div></div>`).join('');
        chatBox.scrollTop=chatBox.scrollHeight;
      }
      renderChat();
      $('#btnSendChat').onclick=()=>{
        const input=$('#chatInput');
        const msg=input.value.trim(); if(!msg) return;
        chat.push({me:true,msg,ts:Date.now()});
        renderChat(); input.value='';
        setTimeout(()=>{chat.push({me:false,msg:'ê´€ë¦¬ì: ë¬¸ì˜ ê°ì‚¬í•©ë‹ˆë‹¤!',ts:Date.now()}); renderChat();},600)
      }
      $('#btnDetailPay').onclick=()=>{showToast('ê²°ì œ ëª¨ë“ˆ ì—°ê²° ì „: í…ŒìŠ¤íŠ¸ ê²°ì œ ì™„ë£Œ ì²˜ë¦¬');}
    }

    function renderReviewsFor(festivalId,wrap){
      const items=state.reviews.filter(r=>r.festivalId===festivalId);
      wrap.innerHTML= items.length? items.map((r,i)=>`<div class='card' style='margin:8px 0'>
          <div class='body'>
            <div class='row-between'><div class='h3'>${r.user}</div><span class='muted'>${new Date(r.createdAt).toLocaleString('ko-KR')}</span></div>
            <p>${r.text}</p>
            <div class='row' style='gap:6px'>
              <input placeholder='ëŒ“ê¸€' class='pill' id='reply-${i}'>
              <button class='btn ghost' data-reply='${i}'>ë‹¬ê¸°</button>
            </div>
            <div style='margin-top:6px'>${(r.replies||[]).map(a=>`<div class='chip'>${a}</div>`).join('')}</div>
          </div>
        </div>`).join('') : `<div class='muted'>ì•„ì§ ë¦¬ë·°ê°€ ì—†ì–´ìš”.</div>`;
      wrap.querySelectorAll('[data-reply]').forEach(btn=>btn.addEventListener('click',()=>{
        const i=parseInt(btn.dataset.reply); const input=wrap.querySelector('#reply-'+i);
        const val=input.value.trim(); if(!val) return; (state.reviews.filter(r=>r.festivalId===festivalId)[i].replies ||= []).push(val); renderReviewsFor(festivalId,wrap);
      }));
    }

    function renderBoard(){
      const tbody=$('#noticeTable tbody');
      tbody.innerHTML=state.notices.map(n=>`<tr><td>${n.title}</td><td>${n.user}</td><td>${new Date(n.ts).toLocaleDateString('ko-KR')}</td></tr>`).join('');
      const list=$('#reviewList');
      list.innerHTML=state.reviews.map(r=>`<div class='card' style='margin:8px 0'><div class='body'><div class='row-between'><div class='h3'>${r.user}</div><span class='muted'>${new Date(r.createdAt).toLocaleString('ko-KR')}</span></div><p>${r.text}</p><div>${(r.replies||[]).map(a=>`<span class='chip'>${a}</span>`).join('')}</div></div></div>`).join('');
    }

    function renderAdmin(){
      const tp=$('#tblProposals tbody');
      tp.innerHTML=state.proposals.filter(p=>!p.approved).map((p,i)=>`<tr><td>${p.name}</td><td>${p.orgType}</td><td>${fmtDate(p.start)}~${fmtDate(p.end)}</td><td><button class='btn ok' data-approve='${i}'>ìŠ¹ì¸</button></td></tr>`).join('');
      tp.querySelectorAll('[data-approve]').forEach(btn=>btn.addEventListener('click',()=>{
        const idx=parseInt(btn.dataset.approve);
        const p=state.proposals.filter(x=>!x.approved)[idx]; p.approved=true; showToast('ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤'); renderAdmin(); renderFestivalsTable();
      }))
      renderFestivalsTable();
    }

    function renderFestivalsTable(){
      const tf=$('#tblFestivals tbody');
      const dataset=[...mockFestivals, ...state.proposals.filter(p=>p.approved).map(p=>({id:'p-'+Math.random().toString(36).slice(2,7),name:p.name,region:p.region,city:'',start:p.start,end:p.end,tags:[],likes:0,thumbnail:'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1200&auto=format&fit=crop',desc:p.desc,weather:[],nearby:[]}))];
      tf.innerHTML=dataset.map(f=>`<tr><td>${f.name}</td><td>${f.region}</td><td>${fmtDate(f.start)}~${fmtDate(f.end)}</td><td><button class='btn' data-open='${f.id}'>ë³´ê¸°</button></td></tr>`).join('');
      tf.querySelectorAll('[data-open]').forEach(b=>b.addEventListener('click',()=>openDetail(b.dataset.open)))
    }

    // ===== Modals =====
    const openModal=id=>{$('#'+id).style.display='flex'}
    const closeModal=id=>{$('#'+id).style.display='none'}
    $$('[data-close]').forEach(b=>b.addEventListener('click',()=>closeModal(b.dataset.close)))

    // ===== Nav Links =====
    $$('[data-link]').forEach(a=>a.addEventListener('click',e=>{e.preventDefault(); setPage(a.dataset.link); if(a.dataset.link==='board') renderBoard(); if(a.dataset.link==='admin') renderAdmin();}))

    // ===== Header Buttons =====
    $('#btnSearch').onclick=()=>{ setPage('list'); renderList(); }

    // ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
    $('#btnLogin').onclick=()=>{ openModal('modalLogin'); }
    $('#btnDoLogin').onclick=()=>{
      state.user={name:'ì‚¬ìš©ì',role:'USER'};
      $('#btnLogin').style.display='none';
      $('#btnSignup').style.display='none';
      $('#btnAdmin').style.display='none';
      $('#meBox').style.display='flex';
      closeModal('modalLogin');
      showToast('ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤');
    }
    $('#btnLogout').onclick=()=>{
      state.user=null;
      $('#btnLogin').style.display='inline-flex';
      $('#btnSignup').style.display='inline-flex';
      $('#btnAdmin').style.display='inline-flex';
      $('#meBox').style.display='none';
      showToast('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤')
    }

    // íšŒì›ê°€ì… í”Œë¡œìš°
    $('#btnSignup').onclick=()=>openModal('modalSignupChoice');
    $('#goSignupUser').onclick=()=>{
      state.signupType='USER';
      $('#signupTitle').textContent='ì¼ë°˜íšŒì› ê°€ì…';
      $$('.company-only').forEach(el=>el.style.display='none');
      openModal('modalSignupForm');
    };
    $('#goSignupCompany').onclick=()=>{
      state.signupType='COMPANY';
      $('#signupTitle').textContent='ê¸°ì—…íšŒì› ê°€ì…';
      $$('.company-only').forEach(el=>el.style.display='grid');
      openModal('modalSignupForm');
    };
    $('#btnDoSignup').onclick=()=>{
      const name=$('#suName').value.trim();
      const email=$('#suEmail').value.trim();
      if(!name||!email) return showToast('ì´ë¦„/ì´ë©”ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤');
      closeModal('modalSignupForm'); closeModal('modalSignupChoice');
      showToast((state.signupType==='COMPANY'?'ê¸°ì—…':'ì¼ë°˜')+' íšŒì›ê°€ì… ì™„ë£Œ!');
    };

    // ê´€ë¦¬ì ë²„íŠ¼ (ìš°ìƒë‹¨)
    $('#btnAdmin').onclick=()=>{ setPage('admin'); renderAdmin(); }

    // ê²Œì‹œíŒ: ê³µì§€/ë¦¬ë·°/ê²°ì œ
    $('#btnPostNotice').onclick=()=>{
      const title=$('#noticeTitle').value.trim(); const body=$('#noticeBody').value.trim();
      if(!title||!body) return showToast('ì œëª©/ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”');
      state.notices.unshift({title,body,user:(state.user?state.user.name:'ê´€ë¦¬ì'),ts:Date.now()});
      $('#noticeTitle').value=''; $('#noticeBody').value=''; renderBoard(); showToast('ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
    }
    $('#btnAddReview').onclick=()=>{
      const user=$('#reviewUser').value||'ìµëª…'; const text=$('#reviewText').value.trim(); if(!text) return;
      state.reviews.unshift({festivalId:'global',user,text,createdAt:Date.now(),replies:[]});
      $('#reviewText').value=''; renderBoard();
    }
    $('#btnPay').onclick=()=>showToast('ê²°ì œ í…ŒìŠ¤íŠ¸: ì™„ë£Œ ì²˜ë¦¬');

    // ì¶•ì œ ë“±ë¡ í˜ì´ì§€
    $('#btnPreviewProposal').onclick=()=>{
      const data=getProposalForm();
      $('#previewBody').innerHTML=`<div class='grid g-2'>
        <div><div class='muted'>ì£¼ìµœ</div><div class='h3'>${data.orgType}</div></div>
        <div><div class='muted'>ì—°ë½ì²˜</div><div class='h3'>${data.contact}</div></div>
        <div style='grid-column:1/-1'><div class='muted'>ì¶•ì œëª…</div><div class='h2'>${data.name}</div></div>
        <div><div class='muted'>ì§€ì—­</div><div class='h3'>${data.region}</div></div>
        <div><div class='muted'>ê¸°ê°„</div><div class='h3'>${fmtDate(data.start)} ~ ${fmtDate(data.end)}</div></div>
        <div style='grid-column:1/-1'><div class='muted'>ì„¤ëª…</div><p>${data.desc}</p></div>
      `;
      openModal('modalPreview');
    }
    $('#btnSubmitProposal').onclick=()=>{
      const data=getProposalForm();
      if(!data.name||!data.region) return showToast('ì¶•ì œëª…/ì§€ì—­ì€ í•„ìˆ˜ì…ë‹ˆë‹¤');
      state.proposals.unshift({...data,approved:false}); showToast('ì œì¶œ ì™„ë£Œ! ê´€ë¦¬ì ìŠ¹ì¸ ëŒ€ê¸°');
      ['pName','pRegion','pAddress','pDesc','contact'].forEach(id=>$('#'+id).value='');
    }
    function getProposalForm(){
      return {orgType:$('#orgType').value, contact:$('#contact').value, name:$('#pName').value, region:$('#pRegion').value, address:$('#pAddress').value, start:$('#pStart').value, end:$('#pEnd').value, desc:$('#pDesc').value}
    }

    // Init
    renderHome();
  </script>
</body>
</html>
