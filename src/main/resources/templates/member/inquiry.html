<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>1:1 ë¬¸ì˜ â€” FesLite</title>
  <script defer th:src="@{/js/app.js}"></script>
  <link rel="stylesheet" th:href="@{/css/mystyle.css}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: linear-gradient(135deg,#ffdee9 0%,#b5fffc 100%);
      font-family: 'Pretendard', sans-serif;
    }

    .mypage-wrapper {
      display: grid;
      grid-template-columns: 240px 1fr;
      gap: 24px;
      max-width: 1100px;
      margin: 40px auto;
      padding: 0 16px;
    }

    .sidebar {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 4px 14px rgba(0,0,0,.1);
      padding: 20px 16px;
    }

    .menu a {
      display: flex;
      justify-content: space-between;
      padding: 10px 12px;
      border-radius: 10px;
      text-decoration: none;
      color: #333;
      font-weight: 600;
      transition: .15s;
    }
    .menu a:hover { background:#f0f2ff; color:#6b21a8; }
    .menu a.active { background:#6b21a8; color:#fff; font-weight:700; }

    .main {
      background:#fff;
      border-radius:20px;
      box-shadow:0 4px 14px rgba(0,0,0,.1);
      padding:30px;
    }

    label {display:block;margin-top:12px;font-weight:600;}
    input,textarea {
      width:100%;
      padding:10px;
      border:1px solid #ccc;
      border-radius:8px;
      margin-top:4px;
    }

    button {
      padding:10px 16px;
      border:none;
      border-radius:8px;
      background:#6b21a8;
      color:#fff;
      font-weight:700;
      cursor:pointer;
    }
    button.special-btn {margin:20px 0;}

    /* âœ… ë¬¸ì˜ ë‚´ì—­ ì„¹ì…˜ */
    .inquiry-list {margin-top:40px;}
    .inquiry-list h4 {font-weight:800;margin-bottom:16px;}

    .inquiry-item {
      border:1px solid #eee;
      border-radius:12px;
      margin-bottom:12px;
      overflow:hidden;
      box-shadow:0 2px 6px rgba(0,0,0,0.05);
      background:#fff;
      transition:all .2s ease;
    }

    .inquiry-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:16px 18px;
      cursor:pointer;
      background:#fafafa;
      transition:background .15s;
    }
    .inquiry-header:hover {background:#f3f0ff;}

    .inquiry-title {
      font-weight:700;
      color:#333;
    }

    .status {
      font-weight:700;
      border-radius:8px;
      padding:6px 10px;
      font-size:13px;
    }
    .status.waiting {
      background:#fef9c3;
      color:#854d0e;
    }
    .status.answered {
      background:#dcfce7;
      color:#065f46;
    }

    .inquiry-content {
      display:none;
      padding:18px 22px;
      border-top:1px solid #eee;
      background:#fff;
      line-height:1.6;
      color:#555;
      font-size:14px;
      animation:fadeIn .25s ease;
    }

    .inquiry-item.active .inquiry-content {
      display:block;
    }

    .answer-box {
      margin-top:12px;
      padding:14px 16px;
      border-radius:10px;
      background:#f3f0ff;
      color:#4a148c;
      font-weight:500;
    }

    @keyframes fadeIn {
      from {opacity:0; transform:translateY(-3px);}
      to {opacity:1; transform:translateY(0);}
    }

    @media(max-width:900px){
      .mypage-wrapper{grid-template-columns:1fr;}
    }
  </style>
</head>

<body>
  <div th:replace="~{common/header :: header}"></div>

  <main class="mypage-wrapper">
    <div th:replace="~{common/memberAside :: aside}"></div>

    <section class="main">
      <h3>1:1 ë¬¸ì˜</h3>
      <form id="inquiryForm" th:action="@{/mypage/regInquiry}" method="post" th:object="${inquiry}">
        <label>ë¬¸ì˜ ì œëª©</label>
        <input type="text" id="title" placeholder="ì˜ˆ: ì¶•ì œ ë“±ë¡ ê´€ë ¨ ë¬¸ì˜" th:field="*{inquiry_title}" required>
        <label>ë¬¸ì˜ ë‚´ìš©</label>
        <textarea id="content" rows="5" th:field="*{inquiry_content}" required></textarea>
        <button class="special-btn" type="submit">ë¬¸ì˜ ë³´ë‚´ê¸°</button>
      </form>
      <p id="resultMsg" style="margin-top:20px;color:#6b21a8;font-weight:600;"></p>

      <!-- ë‚˜ì˜ ë¬¸ì˜ ë‚´ì—­ -->
      <div class="inquiry-list">
        <h4>ë‚´ ë¬¸ì˜ ë‚´ì—­</h4>

        <div class="inquiry-item" th:each="inq : ${inquiryList}">
          <div class="inquiry-header">
            <div class="inquiry-title" th:text="${inq.inquiry_title}"></div>
            <div class="status"
                 th:classappend="${inq.inquiry_answer != null} ? 'answered' : 'waiting'"
                 th:text="${inq.inquiry_answer != null} ? 'ë‹µë³€ì™„ë£Œ' : 'ëŒ€ê¸°ì¤‘'">
              ëŒ€ê¸°ì¤‘
            </div>
          </div>

          <div class="inquiry-content">
            <p th:text="${inq.inquiry_content}"></p>

            <div class="answer-box" th:if="${inq.inquiry_answer != null}">
              <strong>ë‹µë³€:</strong>
              <p th:text="${inq.inquiry_answer}">ë‹´ë‹¹ìì˜ ë‹µë³€ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
          </div>
        </div>

        <!-- ë¬¸ì˜ ì—†ì„ ë•Œ -->
        <div th:if="${#lists.isEmpty(inquiryList)}" style="text-align:center;color:#777;padding:30px;">
          ì•„ì§ ë“±ë¡ëœ ë¬¸ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">Â© 2025 FesLite â€” ëª¨ë‘ì˜ ì¶•ì œë¥¼ ì—°ê²°í•©ë‹ˆë‹¤ ğŸ¡</div>
  </footer>

  <script>
    // âœ… ë©”ë‰´ í™œì„±í™”
    document.addEventListener('DOMContentLoaded', () => {
      const links = document.querySelectorAll('.menu a');
      const currentPath = window.location.pathname.split("/").pop();
      links.forEach(link => {
        const href = link.getAttribute('href');
        if (currentPath === href) link.classList.add('active');
      });
    });

    // âœ… ë¬¸ì˜ ì „ì†¡ ì‹œ ì²˜ë¦¬
    document.getElementById('inquiryForm').addEventListener('submit', e => {
      e.preventDefault();
      const formData = new FormData(e.target);

      fetch(e.target.action, { method: 'POST', body: formData })
        .then(res => {
          if (res.ok) {
            document.getElementById('resultMsg').innerText = "ë¬¸ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!";
            e.target.reset();
          } else {
            document.getElementById('resultMsg').innerText = "ë¬¸ì˜ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
          }
        })
        .catch(() => {
          document.getElementById('resultMsg').innerText = "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        });
    });

    // âœ… ì•„ì½”ë””ì–¸ ê¸°ëŠ¥
    document.addEventListener('click', e => {
      const header = e.target.closest('.inquiry-header');
      if (!header) return;
      const item = header.parentElement;
      item.classList.toggle('active');
    });
  </script>
</body>
</html>
